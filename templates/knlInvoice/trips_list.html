{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Truck Trips - Kamrate{% endblock %}

{% block content %}
<main>
  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1>üöö Truck Trips</h1>
      <p class="text-muted">Manage and track all truck trips</p>
    </div>
    <div class="btn-group">
      <a href="{% url 'knlInvoice:trip-create' %}" class="btn btn-primary" style="background-color: var(--kamrate-orange); border-color: var(--kamrate-orange); font-weight: 700;">
        ‚ûï New Trip
      </a>
      <a href="{% url 'knlInvoice:trip-invoice-list' %}" class="btn btn-outline-secondary">
        üìã Manifest Invoices
      </a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Summary Cards (3 columns - matching Manifest Invoices) -->
  <div class="row mb-4">
    <!-- Total Trips -->
    <div class="col-md-4">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700; font-size: 0.85rem;">TOTAL TRIPS</h6>
          <h3 style="color: var(--kamrate-blue); margin: 0; font-weight: 800; font-size: 2rem;">{{ total_trips }}</h3>
        </div>
      </div>
    </div>

    <!-- Total Revenue -->
    <div class="col-md-4">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700; font-size: 0.85rem;">TOTAL REVENUE</h6>
          <h3 style="color: var(--kamrate-orange); margin: 0; font-weight: 800; font-size: 2rem;">‚Ç¶{{ total_revenue|floatformat:0 }}</h3>
        </div>
      </div>
    </div>

    <!-- Completed Trips -->
    <div class="col-md-4">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700; font-size: 0.85rem;">COMPLETED</h6>
          <h3 style="color: #0D7A3D; margin: 0; font-weight: 800; font-size: 2rem;">{{ completed_count }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Trips Table Card -->
  <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <!-- Card Header -->
    <div class="card-header" style="background-color: #f8f9fa; border-bottom: 2px solid var(--kamrate-orange); padding: 20px;">
      <h5 style="color: var(--kamrate-blue); font-weight: 800; margin: 0;">All Trips</h5>
    </div>

    <!-- Card Body -->
    <div class="card-body p-0">
      {% if trips %}
        <!-- Responsive Table -->
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <!-- Table Header -->
            <thead style="background-color: #f8f9fa; border-bottom: 2px solid #e9ecef;">
              <tr>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Trip #</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Date</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Truck</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Route</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Revenue</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Status</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800; font-size: 0.9rem;">Actions</th>
              </tr>
            </thead>

            <!-- Table Body -->
            <tbody>
              {% for trip in trips %}
              <tr style="border-bottom: 1px solid #e9ecef; transition: all 0.2s ease;">
                <!-- Trip Number Badge -->
                <td style="padding: 15px; vertical-align: middle;">
                  <span class="badge" style="background-color: var(--kamrate-blue); color: white; padding: 6px 10px; font-weight: 600;">
                    {{ trip.tripNumber }}
                  </span>
                </td>

                <!-- Date -->
                <td style="padding: 15px; color: #333; vertical-align: middle;">
                  {{ trip.startDate|date:"M d, Y" }}
                </td>

                <!-- Truck -->
                <td style="padding: 15px; vertical-align: middle;">
                  <strong style="color: var(--kamrate-blue);">{{ trip.truck.plateNumber }}</strong>
                </td>

                <!-- Route -->
                <td style="padding: 15px; color: #333; vertical-align: middle;">
                  {{ trip.origin }} ‚Üí {{ trip.destination }}
                </td>

                <!-- Revenue -->
                <td style="padding: 15px; vertical-align: middle;">
                  <strong style="color: #0D7A3D; font-weight: 800;">‚Ç¶{{ trip.revenue|floatformat:0 }}</strong>
                </td>

                <!-- Status Badge -->
                <td style="padding: 15px; vertical-align: middle;">
                  {% if trip.status == 'COMPLETED' %}
                    <span class="badge" style="background-color: #0D7A3D; color: white; padding: 6px 10px; font-weight: 600; border-radius: 4px;">‚úì Completed</span>
                  {% elif trip.status == 'IN_PROGRESS' %}
                    <span class="badge" style="background-color: var(--kamrate-orange); color: white; padding: 6px 10px; font-weight: 600; border-radius: 4px;">‚ü≥ In Progress</span>
                  {% elif trip.status == 'PENDING' %}
                    <span class="badge" style="background-color: #95a5a6; color: white; padding: 6px 10px; font-weight: 600; border-radius: 4px;">‚è≥ Pending</span>
                  {% else %}
                    <span class="badge" style="background-color: #95a5a6; color: white; padding: 6px 10px; font-weight: 600; border-radius: 4px;">{{ trip.status }}</span>
                  {% endif %}
                </td>

                <!-- Actions -->
                <td style="padding: 15px; vertical-align: middle;">
                  <div style="display: flex; gap: 5px;">
                    <a href="{% url 'knlInvoice:trip-detail' pk=trip.pk %}" 
                       class="btn btn-sm btn-outline-primary" 
                       title="View Trip Details"
                       style="padding: 6px 10px; font-size: 0.85rem;">
                      üëÅÔ∏è View
                    </a>
                    <a href="{% url 'knlInvoice:trip-update' pk=trip.pk %}" 
                       class="btn btn-sm btn-outline-secondary" 
                       title="Edit Trip"
                       style="padding: 6px 10px; font-size: 0.85rem;">
                      ‚úèÔ∏è Edit
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <!-- Empty State -->
        <div class="alert alert-info m-4 p-5 text-center" style="border: none; background-color: #d1ecf1; border-radius: 8px;">
          <h5 style="color: var(--kamrate-blue); font-weight: 800; margin-bottom: 10px;">üöö No Trips Yet</h5>
          <p class="text-muted mb-3">Create your first trip to get started</p>
          <a href="{% url 'knlInvoice:trip-create' %}" 
             class="btn btn-primary" 
             style="background-color: var(--kamrate-orange); border-color: var(--kamrate-orange); font-weight: 700;">
            ‚ûï Create First Trip
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</main>

<style>
  /* Hover effect for table rows */
  .table tbody tr:hover {
    background-color: #f8f9fa;
    transition: all 0.2s ease;
  }

  /* Card hover effect */
  .card {
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12) !important;
  }

  /* Button styling */
  .btn {
    border-radius: 5px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn:hover {
    transform: translateY(-2px);
  }

  /* Badge styling */
  .badge {
    border-radius: 4px;
    font-weight: 600;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .table thead th, .table tbody td {
      padding: 10px 8px !important;
      font-size: 0.85rem;
    }

    .btn-sm {
      padding: 4px 8px !important;
      font-size: 0.75rem;
    }
  }
</style>
{% endblock %}