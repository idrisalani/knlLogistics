{# Quick Add Truck Modal - Include this in trip creation template #}

<div class="modal fade" id="addTruckModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content border-left-primary">
            <div class="modal-header" style="background: linear-gradient(135deg, #001F4D 0%, #003366 100%); color: white;">
                <h5 class="modal-title">
                    <i class="fas fa-truck-loading"></i> Add New Truck
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <form id="addTruckForm">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Alert for messages -->
                    <div id="truckFormAlert" class="alert d-none" role="alert"></div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Plate Number <span class="text-danger">*</span></label>
                            <input 
                                type="text" 
                                name="plateNumber" 
                                id="plateNumber"
                                class="form-control" 
                                placeholder="e.g., KRD 123 XY"
                                required
                            >
                            <small class="form-text text-muted">Unique vehicle plate number</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Model <span class="text-danger">*</span></label>
                            <input 
                                type="text" 
                                name="model" 
                                id="model"
                                class="form-control" 
                                placeholder="e.g., Howo 10-ton"
                                required
                            >
                            <small class="form-text text-muted">Vehicle model name</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Manufacturer <span class="text-danger">*</span></label>
                            <input 
                                type="text" 
                                name="manufacturer" 
                                id="manufacturer"
                                class="form-control" 
                                placeholder="e.g., Sinotruk"
                                required
                            >
                            <small class="form-text text-muted">Vehicle manufacturer</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Year <span class="text-danger">*</span></label>
                            <input 
                                type="number" 
                                name="yearOfManufacture" 
                                id="yearOfManufacture"
                                class="form-control" 
                                placeholder="2020"
                                min="1990"
                                max="2099"
                                required
                            >
                            <small class="form-text text-muted">Year of manufacture</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Capacity (Tons) <span class="text-danger">*</span></label>
                            <input 
                                type="number" 
                                name="capacity" 
                                id="capacity"
                                class="form-control" 
                                step="0.01"
                                placeholder="10.5"
                                required
                            >
                            <small class="form-text text-muted">Load capacity in tons</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label font-weight-bold">Status <span class="text-danger">*</span></label>
                            <select name="status" id="status" class="form-select" required>
                                <option value="">Select status...</option>
                                <option value="ACTIVE" selected>Active</option>
                                <option value="MAINTENANCE">Under Maintenance</option>
                                <option value="INACTIVE">Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Driver Name</label>
                            <input 
                                type="text" 
                                name="driverName" 
                                id="driverName"
                                class="form-control" 
                                placeholder="Optional"
                            >
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Driver Phone</label>
                            <input 
                                type="tel" 
                                name="driverPhone" 
                                id="driverPhone"
                                class="form-control" 
                                placeholder="Optional"
                            >
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Add Truck
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .border-left-primary {
        border-left: 4px solid #FF9500 !important;
    }
    
    .modal-body {
        padding: 2rem;
    }
    
    .form-label {
        margin-bottom: 0.5rem;
        color: #001F4D;
    }
    
    .form-control, .form-select {
        border-left: 3px solid #FF9500;
    }
    
    .form-control:focus, .form-select:focus {
        border-left-color: #001F4D;
        box-shadow: 0 0 0 0.2rem rgba(0, 31, 77, 0.25);
    }
</style>

<script>
document.getElementById('addTruckForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const alertBox = document.getElementById('truckFormAlert');
    const submitBtn = this.querySelector('button[type="submit"]');
    
    // Show loading state
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
    
    fetch('{% url "quick-add-truck" %}', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            alertBox.classList.remove('d-none', 'alert-danger');
            alertBox.classList.add('alert-success');
            alertBox.innerHTML = `
                <i class="fas fa-check-circle"></i> 
                <strong>Success!</strong> ${data.message}
            `;
            
            // Close modal after 1 second
            setTimeout(() => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('addTruckModal'));
                modal.hide();
                
                // Refresh page to show new truck in dropdown
                location.reload();
            }, 1000);
        } else {
            // Show error message
            alertBox.classList.remove('d-none', 'alert-success');
            alertBox.classList.add('alert-danger');
            let errorMsg = '<i class="fas fa-exclamation-circle"></i> <strong>Error!</strong><br>';
            
            if (data.errors && typeof data.errors === 'object') {
                for (let field in data.errors) {
                    errorMsg += `<strong>${field}:</strong> ${data.errors[field].join(', ')}<br>`;
                }
            } else {
                errorMsg += data.message || 'An error occurred';
            }
            
            alertBox.innerHTML = errorMsg;
            
            // Re-enable submit button
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Add Truck';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alertBox.classList.remove('d-none', 'alert-success');
        alertBox.classList.add('alert-danger');
        alertBox.innerHTML = `<i class="fas fa-exclamation-circle"></i> <strong>Error!</strong> ${error}`;
        
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save"></i> Add Truck';
    });
});
</script>