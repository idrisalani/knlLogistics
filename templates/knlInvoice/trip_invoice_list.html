{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Manifest Invoices - Kamrate{% endblock %}

{% block content %}
<main>
  <div class="page-header">
    <div>
      <h1>üìã Manifest Invoices</h1>
      <p class="text-muted">Multi-trip invoice management system</p>
    </div>
    <div class="btn-group">
      <a href="{% url 'knlInvoice:trip-invoice-create' %}" class="btn btn-primary" style="background-color: var(--kamrate-orange); border-color: var(--kamrate-orange); font-weight: 700;">
        ‚ûï Create New Invoice
      </a>
      <a href="{% url 'knlInvoice:trips-list' %}" class="btn btn-outline-secondary">
        üöö View Trips
      </a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700;">TOTAL INVOICES</h6>
          <h3 style="color: var(--kamrate-blue); margin: 0; font-weight: 800;">{{ invoices.count }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700;">TOTAL REVENUE</h6>
          <h3 style="color: var(--kamrate-orange); margin: 0; font-weight: 800;">‚Ç¶{{ total_revenue|floatformat:0 }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700;">AMOUNT PAID</h6>
          <h3 style="color: #0D7A3D; margin: 0; font-weight: 800;">‚Ç¶{{ total_paid|floatformat:0 }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h6 class="text-muted mb-2" style="font-weight: 700;">OUTSTANDING</h6>
          <h3 style="color: #dc3545; margin: 0; font-weight: 800;">‚Ç¶{{ total_outstanding|floatformat:0 }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoices Table -->
  <div class="card" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <div class="card-header" style="background-color: #f8f9fa; border-bottom: 2px solid var(--kamrate-orange); padding: 20px;">
      <h5 style="color: var(--kamrate-blue); font-weight: 800; margin: 0;">All Invoices</h5>
    </div>

    <div class="card-body p-0">
      {% if invoices %}
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead style="background-color: #f8f9fa; border-bottom: 2px solid #e9ecef;">
              <tr>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Invoice #</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Client</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Containers</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Total</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Paid</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Status</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Due Date</th>
                <th style="padding: 15px; color: var(--kamrate-blue); font-weight: 800;">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for invoice in invoices %}
              <tr style="border-bottom: 1px solid #e9ecef;">
                <td style="padding: 15px;">
                  <strong style="color: var(--kamrate-blue);">{{ invoice.invoice_number }}</strong>
                </td>
                <td style="padding: 15px;">
                  {{ invoice.client.clientName|default:"No Client" }}
                </td>
                <td style="padding: 15px;">
                  <span class="badge bg-info" style="padding: 6px 10px; font-weight: 600;">{{ invoice.line_items.count }}</span>
                </td>
                <td style="padding: 15px;">
                  <strong style="color: #0D7A3D; font-weight: 800;">‚Ç¶{{ invoice.total|floatformat:2 }}</strong>
                </td>
                <td style="padding: 15px;">
                  <span style="color: #0D7A3D; font-weight: 600;">‚Ç¶{{ invoice.amount_paid|floatformat:2 }}</span>
                </td>
                <td style="padding: 15px;">
                  <span class="badge" 
                        style="background-color: 
                          {% if invoice.status == 'draft' %}#808080
                          {% elif invoice.status == 'sent' %}#0099ff
                          {% elif invoice.status == 'pending' %}#ff6600
                          {% elif invoice.status == 'paid' %}#00cc00
                          {% elif invoice.status == 'overdue' %}#ff0000
                          {% else %}#999999{% endif %}; 
                          padding: 6px 10px; font-weight: 600;">
                    {{ invoice.get_status_display }}
                  </span>
                </td>
                <td style="padding: 15px;">
                  {% if invoice.due_date %}
                    <small>{{ invoice.due_date|date:"d M Y" }}</small>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td style="padding: 15px;">
                  <div style="display: flex; gap: 5px;">
                    <a href="{% url 'knlInvoice:trip-invoice-detail' pk=invoice.pk %}" 
                       class="btn btn-sm btn-outline-primary" title="View">
                      üëÅÔ∏è
                    </a>
                    {% if invoice.status == 'draft' %}
                    <a href="{% url 'knlInvoice:trip-invoice-edit' pk=invoice.pk %}" 
                       class="btn btn-sm btn-outline-secondary" title="Edit">
                      ‚úèÔ∏è
                    </a>
                    {% endif %}
                    <a href="{% url 'knlInvoice:trip-invoice-delete' pk=invoice.pk %}" 
                       class="btn btn-sm btn-outline-danger" title="Delete">
                      üóëÔ∏è
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="alert alert-info m-4 p-5 text-center">
          <h5 style="color: var(--kamrate-blue); font-weight: 800; margin-bottom: 10px;">üìã No Invoices Yet</h5>
          <p class="text-muted mb-3">Create your first manifest invoice to get started</p>
          <a href="{% url 'knlInvoice:trip-invoice-create' %}" class="btn btn-primary" style="background-color: var(--kamrate-orange); border-color: var(--kamrate-orange);">
            ‚ûï Create First Invoice
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</main>
{% endblock %}